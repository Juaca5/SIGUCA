extends layout

block sigucaCSS
  link(rel='stylesheet', href='/stylesheets/cal-heatmap.css')

block content
    div.container
      .info
       h3 Reportes de eventos 
       h4 #{empleado}   

      div.filter
        h3 Filtros   
        table
          form(role='form', method="POST", action="/filtrarEventos/")
            td
              select.form-control.selectpicker(data-style="btn-success", data-width="auto", type="text", name="filtro") 
                option(value= "todos|reportes") Todos los usuarios
                each user in usuarios
                  option(value= user._id + "|reportes") #{user.apellido1} #{user.apellido2}, #{user.nombre}
            td
              label.labelFiltro.labFilLeft(for='fechaDesde') Desde:
                div.input-group
                  input#date_range_start.form-control(type='text', name='fechaDesde')
                  span.input-group-addon
                    i.icon-calendar
            td
              label.labelFiltro(for='fechaHasta') Hasta:
                div.input-group
                  input#date_range_end.form-control(type='text', name='fechaHasta')
                  span.input-group-addon
                    i.icon-calendar
            td
              button.filtro.form-control.btn.btn-success(type='submit', name='gestionar') Buscar
            //
              td
                button#toPDF.form-control.btn.btn-primary(name='toPDF') PDF

      .col-xs-12
        div#calSupervisor
          button#previous.btn.btn-default
            i.icon.icon-chevron-left
          button#next.btn.btn-default 
            i.icon.icon-chevron-right
          div#cal


        .filtroCierres
          h3 Filtros   
          div.filter
             div.filter
                label#departamento(for='departamento') 
                .btn-group
                   .btn-group
                  select.form-control#selectFiltro.selectpicker(data-style="btn-success", type="text", name="idSupervisor") 
                      optgroup(label="Departamentos")
                        option(value= "Supervisor,todos," + todos) Todos los departamentos
                        each item, i in departamentos
                          option(value= "Supervisor," + item.departamento.id) #{item.departamento.nombre}
                      optgroup(label="Personales")
                        option#supervisor(value= "Empleado,todos," + usuario.id) Mi gráfico
                        option(value= "Empleado,justificaciones," + usuario.id) Justificaciones
                        option(value= "Empleado,solicitudes," + usuario.id) Solicitudes
                        option(value= "Empleado,marcas," + usuario.id) Tardías o Ausencias

        div.eventosCierre
          h3 Detalle diario por departamento
          table.footable
            thead
              tr
                th(data-sort-ignore="true") Acciones
                th(data-sort-ignore="true") Cantidad
            tbody#calDetalle
                tr
                  td Justificaciones
                  td -
                tr
                  td Solicitudes
                  td -
                tr
                  td Ausencias o Tardías
                  td -
        br
        div.tablasReportes
          h3.h3Marcas Marcas
          if(marcas.length != 0)
            table.footable(data-page-navigation=".pagination" data-page-size="25")
                thead
                  tr
                    th(data-type="numeric" data-sort-initial="descending") Fecha
                    th Usuario
                    th Tipo
                tbody
                  each marca, i in marcas
                    tr
                      td(data-value=marca.epoch) #{marca.fecha} 
                      td #{marca.usuario.nombre} #{marca.usuario.apellido1}
                      td #{marca.tipoMarca} 
                tfoot
                  tr
                    td(colspan='3')
                      .pagination.pagination-centered.hide-if-no-paging
          else
            p No se han realizado marcas hasta el momento.
                
          br
          h3 Justificaciones
          if(justificaciones.length != 0)
            table.tableJustificaciones.footable(data-page-navigation=".pagination" data-page-size="5")
                thead
                  tr
                    th(data-type="numeric" data-sort-initial="descending") Fecha
                    th Usuario
                    th(data-hide="phone,small") Motivo
                    th(data-hide="phone,small" data-sort-ignore="true") Detalle
                    th(data-hide="phone,small" data-sort-ignore="true") Comentario
                    th Estado
                    th(data-hide="phone,small" data-sort-ignore="true") Eliminar
                tbody
                  each justificacion, i in justificaciones
                    tr
                      td(data-value=justificacion.fechaCreada) #{justificacion.fecha} 
                      td #{justificacion.usuario.nombre} #{justificacion.usuario.apellido1}
                      td #{justificacion.motivo} 
                      td #{justificacion.detalle} 
                      td #{justificacion.comentarioSupervisor} 
                      td #{justificacion.estado}  
                      td
                        button.btn.btn-default.justificacionDelete(value=justificacion.usuario.nombre+' '+justificacion.usuario.apellido1+' '+justificacion.usuario.apellido2+','+justificacion.id+','+justificacion.fecha, name='eliminar') 
                          i.icon-trash.icon-large.i-danger 
                tfoot
                  tr
                    td(colspan='7')
                      .pagination.pagination-centered.hide-if-no-paging
          else
            p No se han enviado justificaciones hasta el momento.

          br
          h3 Solicitudes Horas Extraordinarias
          if(extras.length != 0)
            table.tableSolicitudes.footable(data-page-navigation=".pagination" data-page-size="5")
                thead
                  tr
                    th(data-type="numeric" data-sort-initial="descending") Fecha
                    th Usuario
                    th(data-hide="phone,small" data-sort-ignore="true") Día de Inicio 
                    th(data-hide="phone,small" data-sort-ignore="true") Día de Termino
                    th(data-hide="phone,small,medium" data-sort-ignore="true") Cantidad de Horas
                    th(data-hide="phone,small,medium") Cliente
                    th(data-hide="phone,small,medium" data-sort-ignore="true") Motivo
                    th(data-hide="phone,small,medium" data-sort-ignore="true") Comentario
                    th(data-hide="phone,small") Estado
                    th(data-hide="phone,small,medium" data-sort-ignore="true") Eliminar
                tbody
                  each extra, i in extras
                    tr
                      td(data-value=extra.fechaCreada) #{extra.fecha} 
                      td #{extra.usuario.nombre} #{extra.usuario.apellido1} 
                      td #{extra.diaInicio} 
                      td #{extra.diaFinal} 
                      td #{extra.cantHoras} 
                      td #{extra.cliente} 
                      td #{extra.motivo} 
                      td #{extra.comentarioSupervisor} 
                      td #{extra.estado} 
                      td
                        button.btn.btn-default.solicitudDelete(value=extra.usuario.nombre+' '+extra.usuario.apellido1+' '+extra.usuario.apellido2+','+extra.id+','+extra.fecha, name='eliminar') 
                          i.icon-trash.icon-large.i-danger 
                tfoot
                  tr
                    td(colspan='10')
                      .pagination.pagination-centered.hide-if-no-paging
          else
            p No se han enviado extras hasta el momento.

          br
          h3 Solicitudes Permisos
          if(permisos.length != 0)
            table.tableSolicitudes.footable(data-page-navigation=".pagination" data-page-size="5")
                thead
                  tr
                    th(data-type="numeric" data-sort-initial="descending") Fecha
                    th Usuario
                    th(data-hide="phone,small") Día Inicial
                    th(data-hide="phone,small") Día Final 
                    th(data-hide="phone,small") Cantidad Días
                    th(data-hide="phone,small,medium") Motivo
                    th(data-hide="phone,small,medium" data-sort-ignore="true") Detalle
                    th(data-hide="phone,small,medium" data-sort-ignore="true") Comentario
                    th Estado
                    th(data-hide="phone,small,medium" data-sort-ignore="true") Eliminar
                tbody
                  each permiso, i in permisos
                    tr
                      td(data-value=permiso.fechaCreada) #{permiso.fecha} 
                      td #{permiso.usuario.nombre} #{permiso.usuario.apellido1} 
                      td #{permiso.diaInicio} 
                      td #{permiso.diaFinal} 
                      td #{permiso.cantidadDias} 
                      td #{permiso.motivo} 
                      td #{permiso.detalle} 
                      td #{permiso.comentarioSupervisor} 
                      td #{permiso.estado} 
                      td
                        button.btn.btn-default.solicitudDelete(value=permiso.usuario.nombre+' '+permiso.usuario.apellido1+' '+permiso.usuario.apellido2+','+permiso.id+','+permiso.fecha, name='eliminar') 
                          i.icon-trash.icon-large.i-danger 
                tfoot
                  tr
                    td(colspan='10')
                      .pagination.pagination-centered.hide-if-no-paging
          else
            p No se han enviado permisos hasta el momento.

          if(horasSemanales != '')
            br
            h3 Horas Semanales 
            table.tableCierres.footable(data-page-navigation=".pagination" data-page-size="11")
                thead
                  tr
                    th(data-type="numeric" data-sort-initial="descending") Fecha
                    th Usuario
                    th(data-sort-ignore="true") Cantidad de horas diarias
                    th(data-sort-ignore="true") Acumulado de horas semanales
                tbody
                  each cierres, i in horasSemanales
                    tr
                      td(data-value=cierres.epoch) #{cierres.fecha} 
                      td #{cierres.usuario.nombre} #{cierres.usuario.apellido1} 
                      - var seg = JSON.stringify(cierres.horasDiarias)
                      - h = parseInt(seg / 60 / 60);
                      - seg -= h*60*60;
                      - m = parseInt(seg / 60);
                      if( m < 10) 
                        td #{h} : 0#{m} 
                      else
                        td #{h} : #{m} 
                      - var seg = JSON.stringify(cierres.horasSemanales)
                      - h = parseInt(seg / 60 / 60);
                      - seg -= h*60*60;
                      - m = parseInt(seg / 60);
                      if( m < 10) 
                        td #{h} : 0#{m} 
                      else
                        td #{h} : #{m} 
                tfoot
                  tr
                    td(colspan='10')
                      .pagination.pagination-centered.hide-if-no-paging

block sigucaJS     
  script(src="/socket.io/socket.io.js")
  script(src="/js/components/d3.min.js")
  script(src="/js/components/cal-heatmap.js")
  script( src='/js/app/sigucaHome.js')